window.transportEval=function(code){return eval("("+code+")");};YUI.add("transport",function(W){var f="MPServices",N="TransportProvider",aC="transport",ao="POST",o="GET",w="proxyUrl",aM="proxyTimeout",x="DaliRequestWs",m="module",aE="cfg.dali.handler.ws",aN="cfg.maple_dali.handler.add",ac="INVALID_CRUMB",aD=aN,I=x,au="ok",am="post",r="pr",z="dt",q="rt",ak="default",ae="response",i="request",a="server",aA="browser",aa="crumb",av="abort",an="timeout",s=a,A="nocookies",U="badcrumb",y="badformat",u=2,aw=1,n=0,b=i,ar=ae,aK=av,L="failure",t="success",Q="failure",C="error",aB=15000,ab=1500,j=2,c=5,p="Gateway Timeout",Z=W.Lang,aG=Z.isString,ay=Z.isFunction,B=Z.isObject,S=Z.isUndefined,aL=Z.isNull,d=Z.isArray,P=Z.isNumber,aI=null,e=false,ad={},al=null,G=n,K=null,v={},l=W.ModulePlatform,h=/Content-Type\:\s([^\n]+)/,E=/boundary=([^\n\s]+)\;/,ag=/\{[^\n]+\}/,at=/Content-ID\:\s([0-9]+)/,O={tData:{},rData:{}};RequestBlackboard=function(){var Y={};var aO=1;return{create:function(aP){Y[aO]=aP;return aO++;},remove:function(aP){if(Y[aP]){delete (Y[aP]);return true;}else{return false;}},setProp:function(aR,aP,aQ){if(Y[aR]){Y[aR][aP]=aQ;}else{return false;}},getProp:function(aQ,aP){if(!S(Y[aQ])){return Y[aQ][aP];}else{return false;}},queryAll:function(aP){var aT=[];for(var aQ in Y){if(Y.hasOwnProperty(aQ)){var aS=Y[aQ];if(!S(aS)&&aP(Y[aQ])){Y[aQ].txId=aQ;var aR=Y[aQ];aT.push(Y[aQ]);}}}return aT;},getByTx:function(aQ){var aP=aQ;return this.queryAll(function(aR){if(aR.transactionId==aP){return true;}else{return false;}});},get:function(aP){return Y[aP];},reset:function(){aO=1;Y={};O={tData:{},rData:{}};},getSize:function(){if(aO===1){return 0;}var aQ=0;for(var aP in Y){aQ++;}return aQ;},_requestStore:Y};}();var aF=function(){var Y=[];return{enqueue:function(aO){return Y.push(aO);},next:function(){return Y.shift();},peek:function(){return Y[0];},getSize:function(){return Y.length;},reset:function(){Y=[];}};}();function H(){l=W.ModulePlatform;aI=null;RequestBlackboard.reset();aF.reset();aj.reset();al=R;ad[m]=aH;ad[x]=ax;G=n;if(ay(e.cancel)){e.cancel();}}function T(){return new Date();}var ah={disable:function(Y){G=Y?u:aw;},enable:function(){if(G===u){af();}G=n;},isEnabled:function(){return(G==n);},setRequestFormatter:function(Y,aO){ad[Y]=aO;},setResponseFormatter:function(Y){al=Y;},abortRequest:function(aO,Y){if((!Y)||Y==RequestBlackboard.getProp(aO,"moduleId")){F(aO);this.fire(aK,{type:av,response:{}});return aq(aO,Q,av,"");}else{return false;}},abortModuleRequests:function(Y){var aO=RequestBlackboard.queryAll(function(aP){return aP.originId==Y;});W.Array.each(aO,function(aP){this.abortRequest(aP.txId,Y);},this);},isRequestPending:function(aP,aO){if(aO){var Y=RequestBlackboard.get(aP);return(B(Y)&&(Y.moduleId==aO));}else{return(RequestBlackboard.get(aP))?true:false;}},makeRequest:function(aP,aR,aQ){if(G!==aw){if(d(aP)&&aP.length>1){for(var aO=0,Y=aP.length;aO<Y;aO++){g(aP[aO],aR,aQ);}return null;}else{return g((d(aP)?aP[0]:aP),aR,aQ);}}else{return false;}},getMetrics:function(Y){return(B(O.rData[Y])?O.rData[Y]:null);},clearMetrics:function(aO){if(aO){delete (O.rData[aO]);}else{var Y=RequestBlackboard.get(aO);if(RequestBlackboard.getSize()>0){O.rData={};}else{O={tData:{},rData:{}};}}},_simulateResponse:function(aS,aP,aR){var aQ="";var Y=aj.simulateResponse;if(aP._raw){Y(1,{status:200,statusText:"OK",responseText:aP._raw});return;}if(aP._result){switch(aP._result){case"abort":Y(1,{status:0,statusText:aP._result},1);break;case"timeout":Y(1,{status:0,statusText:aP._result},1);break;case"ok":aQ='[{"txId":'+aS+',"status":200,"statusText":"OK", "data":';if(aP.html){aQ+='"html":"'+aP.html+'",';}aQ+='{"mods":[{"props":{}}]}}]';var aO='{"props":{}, "status":"OK", "resps":'+aQ+"}";Y(1,{status:200,statusText:"OK",responseText:aO},1);break;case C:if(aP._resultDetail&&aP._resultDetail=="badcrumb"){aQ="[]";Y(1,{status:200,statusText:"ok",responseText:'{"props":{}, "status":400, "statusText":"Bad Request", "resps":'+aQ+"}"},false);return true;}else{if(aP._resultDetail&&aP._resultDetail=="nocookies"){aQ="[]";Y(1,{status:200,statusText:C,responseText:'{"props":{}, "status":400, "statusText":"Bad Request", "resps":'+aQ+"}"},true);return true;}}aQ='[{"txId":'+aS+',"status":404,"statusText":"ERROR", "data":{"mods":[{"props":{}}]}}]';Y(1,{status:404,statusText:"File not Found",responseText:"<html><head><title>404</title></head><body><p>File not found</p></body></html>"},false);break;}}},_reset:H};function aJ(Y){var aQ=W.Object(Y.data);var aP=false;var aO=false;aQ.getResponseHeader=function(aV){if(!aP){this.responseHeader=aQ.responseHeader.replace("\r\n","\n");aO=true;var aS=aQ.responseHeader.split("\n");var aR=aS.length;aP={};for(var aT=0;aT<aR;aT++){var aU=aS[aT].split(": ");aP[aU[0]]=aU[1];}}return aP[aV];};aQ.getAllResponseHeaders=function(){if(!aO){this.responseHeader=aQ.responseHeader.replace("\r\n","\n");}return this.responseHeader;};return W.mix(Y,aQ);}var az=function(aO,Y){if(aO.data&&aO.data.responseText){return aJ(aO);}else{if(aO.data){if(aO.data.mods){aO.mods=aO.data.mods;aO.mod=aO.mods[0];delete (aO.data.mods);}if(aO.data.html){aO.html=aO.data.html;delete (aO.data.html);}if(aO.data.res){aO.res=aO.data.res;delete (aO.data.res);}}return aO;}};function R(aO,Y){return aO;}al=R;function F(Y){if(!RequestBlackboard.getProp(Y,"isBatch")){var aO=RequestBlackboard.getProp("transactionObject");if(B(aO)&&aO.isInProgress()){aO.abort();}}else{}}function aq(aW,aT,aY,aR){var aO=RequestBlackboard.get(aW);if(S(aO)){return false;}var aP=aO.response||{},aU=null,a4=null;aP.result=aY||au;aP.resultDetail=aR||"";aP.originId=aO.originId||null;aP.targetId=aO.targetId||aO.originId;if(aO.html){aP.html=aO.html;}ah.fire(ar,{type:ar,response:aP});if(B(aP.data)){a4=aP.data.res;aU=aP.data.mods;}if(B(aU)){if(aU[0].state&&aU[0].state.defer){if(!ap(aW,aU[0].state)){RequestBlackboard.remove(aW);aP.status=504;aP.statusText=p;aT=Q;}else{return;}}for(var a1=0,Y=aU.length;a1<Y;a1++){if(aU[a1].props&&aU[a1].props.id){aI.registerModule(aU[a1]);}}}aP=az(aP);aP=al(aP,aI);var aZ=aO.cb,aV,aQ=this,a3=null;if(O.tData[aO.transactionId]&&aY==au){a3=O.tData[aO.transactionId];O.rData[aW]={rt:a3.rt,pr:a3.pr,dt:0};}if(!S(aZ.argument)){aP.argument=aZ.argument;aV=aZ.argument;}if(ay(aZ[aT])){var aS=W.bind(aZ[aT],aZ.scope||this,aP,aV);if(B(a4)){var a2=aI.getService("resourcemgr"),aX=null;if(a3){aX=T();var a0=O.rData[aW];}a2.load(a4,function(){if(a3){a0.dt=T()-aX;}aS();});}else{aS();}}return RequestBlackboard.remove(aW);}function ap(aR,aQ){var Y=RequestBlackboard.get(aR);var aS=RequestBlackboard.getProp(aR,"retries");if((aS>(c))){return false;}var aO=aQ.retryCount||c;var aP=aQ.retryInterval;aS=(P(aS))?aS:0;if(aS<aO){++aS;W.Lang.later(aP,this,function(){RequestBlackboard.setProp((g(Y.requestObject,Y.cb,Y.originId)),"retries",aS);});RequestBlackboard.remove(aR);return true;}else{return false;}}function X(aP,aW,aQ){var Y=aP.txId;var aO=RequestBlackboard.get(Y);if(S(aO)){return;}var aR=true;var aU={data:aP.data};var aY,aV;var aS=aO.cb;if(aP.status==200||aP.status==201){aU.status=au;aU.result=au;aY=au;aR=false;}else{aU.status=C;aU.result=C;if(aP.status==400){var aT=aa,aX="Invalid crumb.";aV=U;aY=C;if(!window.navigator.cookieEnabled||aQ=="badcookie"){aT=aA;aV=A;aX="Cookies are disabled";}aI[C](aT,aX);}}RequestBlackboard.setProp(Y,ae,aU);aq(Y,((aR)?Q:t),aY,aV);}function J(Y,aR,aO){var aQ=null,aP=aO||false;if(Y.resps&&Y.resps.length===0){aQ=RequestBlackboard.getByTx(aR);W.Array.each(aQ,function(aU){var aT=aa,aS=U;if(!window.navigator.cookieEnabled||(aP===true)){aT=aA;aS=A;}aI[C](aT,"A crumb error occured: ",Y);aq(aU.txId,Q,C,aS);},this);}else{W.Array.each(Y.resps,function(aS){aI[C](aa,"A crumb error occured: ",Y);aS.status=400;X(aS,ioResponseObj);},this);}delete (v[aR]);}function V(bg,aX,aO){var aT=aO||false,a7=aX.status,bb=bg,a3="",a1=C;if(a7!=200&&a7!=201&&a7!=au){if(a7===0){a1=(aX.statusText==an)?an:av;}else{a3=a;aI[C](a,"A server error occured: ",{responseObject:aX});}var a2=RequestBlackboard.getByTx(bb);W.Array.each(a2,function(bc){if(O.rData[bc.txId]){delete (O.rData[bc.txId]);}aq(bc.txId,Q,a1,a3);});}else{O.tData[bg].startParse=T();var aZ=aX.responseText;var be=aX.getResponseHeader("Content-Type");if(be.indexOf("Multipart/Related")!==-1){var a0=E.exec(be),aQ=aX.responseText.split("--"+a0[1]),ba=aQ.length;for(var a9=1;a9<ba;a9++){var aP=aQ[a9],a6=h.exec(aP),aS=a6[1];if(aS.match(/application\/json/)){var aY=aP.match(ag)[0];aZ=aY;}else{if(aS.match(/text\/html/)){var bh=at.exec(aP),bd=bh[1],aR=aP.substring(aP.search(/\n\n/));aR=Z.trim(aR);RequestBlackboard.setProp(bd,"html",aR);}}}}var aV;try{aV=window.transportEval(aZ);}catch(bf){aI[C](a,"A parse error occured: "+bf.message,bf);var a5=RequestBlackboard.getByTx(bg);W.Array.each(a5,function(bc){aq(bc.txId,Q,C,y);},this);return;}if(!B(aV)){result=C;resultDetail=y;aI[C](a,"A parse error occured: ",aX);var aW=RequestBlackboard.getByTx(bg);W.Array.each(aW,function(bc){aq(bc.txId,Q,result,resultDetail);},this);return;}switch(aV.status){case ac:try{K.dali.crumb=aV.props.dali.crumb;}catch(a8){J(aV,bg,badcoookie);return;}var aU=v[bg];if(S(aU.cfg.retries)){aU.cfg.retries=1;}else{++aU.cfg.retries;}if(aU.cfg.retries<j){var Y=k(aU.cfg,aU.forcepost);var a4=RequestBlackboard.getByTx(bg);W.Array.each(a4,function(bc){bc.transactionId=Y.id;},this);delete (v[bg]);}else{J(aV,bg,aO);}break;case 400:J(aV,bg,aO);break;default:delete (v[bg]);O.tData[bg].pr=T()-O.tData[bg].startParse;W.Array.each(aV.resps,function(bc){X(bc,aX,aT);},this);break;}}}var aj=function(){var aP=null,aO={};function Y(aU,aT,aR){var aS=(new Date())-aO[aU];O.tData[aU]={rt:aS,pr:null};V(aU,aT,aR);}function aQ(aR){aO[aR]=new Date();}return{execute:function(aT,aW,aX){if(!aP){var aV=aI.getProperty(aM);if(!S(aV)){aP=aV;}else{aP=aB;}}var aS=am+"="+encodeURIComponent(aW);aT=(aX==o)?D(aT,"&__r="+new Date().getTime()):aT;var aR={method:aX,data:aS,on:{success:Y,failure:Y,start:aQ},timeout:aP};var aU=W.io(aT,aR);return aU;},simulateResponse:function(aT,aR,aS){aR.getResponseHeader=function(){return"";};if(aS){Y(aT,aR,true);}else{Y(aT,aR,false);}},reset:function(){aO={};v={};}};}();function D(Y,aO){return Y+((Y.indexOf("?")==-1)?"?":"&")+aO;}var ax=function(Y){var aP=aE,aQ=Y.batchable||false;if(S(Y.method)){Y.method="get";}var aO=false;switch(Y.method.toUpperCase()){case ao:aO=true;var aR=Y.data;if(!aG(aR)){aI[C](aC,"data must be a string");}else{Y.data=aR;}break;case (o||"DELETE"):if(Y.data!==undefined&&aG(Y.data)){Y.url=D(Y.url,Y.data);}break;default:}return{handler:aP,data:Y,batchable:aQ,forcepost:aO,targetId:Y.url};};var aH=function(aQ,aR,Y){var aO=aQ.args||{};var aP=aQ.moduleId||null;aO.moduleId=aP;if(aO.maple){aO.maple.module=aP;}else{aO.maple={module:aP};}return{handler:aN,data:aO,batchable:aQ.batchable||false};};ad[m]=aH;ad[x]=ax;function M(aQ,aP){var aO=aP.requestObject;var Y=aO.type||I;aO=(ay(ad[Y]))?ad[Y](aO,aP.moduleId,aI):aO;aO.txId=aQ;if(Y==x&&S(aP.targetId)){aP.targetId=aO.targetId;}if(S(aO.handler)){aO.handler=aD;}return aO;}function g(aO,Y,aR){var aP={requestObject:aO,cb:Y,moduleId:aR,originId:aR};if(aO.moduleId){aP.targetId=aO.moduleId;}var aQ=RequestBlackboard.create(aP);if(aO.batchable!==true&&G===n){af(aQ);}else{aF.enqueue(aQ);if(aO.batchable===true){if(!e){e=W.later(1,this,af);}else{e.cancel();e=W.later(1,this,af);}}else{if(G===n){af();}}}return aQ;}function k(aR,aS){var aO=aI.getProperty(w);if(aL(K)){K={};K.dali=aI.getProperty("dali")||{};}var aP=W.JSON.stringify({reqs:aR,props:K});var Y="GET";if((encodeURIComponent(aP).length>ab)||aS){Y="POST";}var aQ=aj.execute(aO,aP,Y);v[aQ.id]={ioObj:aQ,cfg:aR,forcepost:aS};return aQ;}function af(aV){var aO=false;var aW=[];var aS=[];var aU=false;if(aV){var aT=RequestBlackboard.get(aV);ah.fire(b,{type:b,request:aT.requestObject,originId:aT.originId});var Y=M(aV,aT);aW.push(Y);if(Y.forcepost===true){aU=true;}RequestBlackboard.setProp(aV,"isBatch",false);aS[0]=aV;}else{if(ay(e.cancel)){e.cancel();}var aX=aF.next();while(aX){var aQ=RequestBlackboard.get(aX),aR=false;if(aQ){ah.fire(b,{type:b,request:aQ.requestObject,originId:aQ.originId});aQ=M(aX,aQ);if(aQ.batchable!==true){if(aQ.forcepost===true){aR=true;}tx=k([aQ],aR);RequestBlackboard.setProp(aX,"transactionId",tx.id);RequestBlackboard.setProp(aX,"transactionObject",tx);aO=true;}else{if(aQ.forcepost===true){aU=true;}aW.push(aQ);aS.push(aX);}}aX=aF.next();}}if(aW.length>=1){var aP=k(aW,aU);W.Array.each(aS,function(aY){RequestBlackboard.setProp(aY,"transactionId",aP.id);RequestBlackboard.setProp(aY,"transactionObject",aP);aO=true;});}}function ai(){RequestBlackboard.reset();aF.reset();aj.reset();O={tData:{},rData:{}};}W.on("unload",ai,window);W.augment(ah,W.Event.Target);W.namespace(f);W[f][N]={name:"transport",getService:function(aO,Y){if(Y){return null;}if(!aI){aI=aO;}return ah;}};if(l){l.registerService(W[f][N]);}},"1.6.1",{requires:["event","io"]});/* Copyright (c) 2013, Yahoo! Inc.  All rights reserved. */
YUI.add("metro_dali",function(b){var a=b.ModulePlatform;a.subscribe("init",function(){var f=a.getService("transport"),e=0,d="cfg.maple_dali.handler.add",c="cfg.maple_dali.handler.refresh";f.setResponseFormatter(function(g){if(g.mod){g.data=g.mod.data;}if(g.data){delete g.data.maple;}return g;});f.setRequestFormatter("arcade",function(h,i){var g=b.mix({},h),j=h._id;delete g.type;if(!j){j=i;}if(h._type){j=h._type;}return{handler:c,data:{maple:{module:j,ba:b.merge(g,{_txnid:e++,_mode:"json",_id:j,_container:0,chrome:"false"})}}};});f.setRequestFormatter("loadview",function(k,j){var g=b.mix({},k),i=a.queryModules(function(p){var o=a.getModuleApi(p);return o&&o.getProperty("type")=="pa";})[0],m,n=k.moduleId,h=n,l=a.getModuleApi(n);switch(g.view){case"pa":g={handler:c,data:{maple:{module:i,ba:{_action:"show",_subAction:"single",modId:n,chrome:(g.chrome?"true":"false"),_txnid:e++,_mode:"json",_id:i,_container:(g.chrome?1:0),data:(g.data?g.data:null),cpos:l.getProperty("cpos")||undefined,pointer:(l.isViewOpen("default")||l.isViewOpen("edit"))?1:undefined}}},batchable:true};break;case"default":if(g.chrome){if(i){m=a.queryModules(function(q){var p=a.getModuleApi(q),o=p&&p.getProperty("type");return o=="pacontainer";})[0];h=m;}g={handler:d,data:{maple:{module:h,ba:{_action:"show",chrome:(g.chrome?"true":"false"),_txnid:e++,_mode:"json",_id:h,modId:n,_container:(g.chrome?1:0),view:"default"}}}};break;}default:g={handler:c,data:{maple:{module:n,ba:{_action:"show",_subAction:g.view=="default"?undefined:g.view,view:g.view,_txnid:e++,_mode:"json",_id:n,_container:(g.chrome?1:0),chrome:(g.chrome?"true":"false")}}}};break;}delete g.moduleId;delete g.type;return g;});f.setRequestFormatter("module",function(g,h){var i=g.moduleId;if(!i){i=h;}return{handler:c,data:{maple:{module:i,ba:b.merge({_txnid:e++,_mode:"json",_id:i,_container:0},g.args)}}};});});},"1.0",{requires:["transport"]});/* Copyright (c) 2013, Yahoo! Inc.  All rights reserved. */
YUI.add("module_api",function(a){a.ModuleApi=function(d,i){var h=i.props,f=a.Lang.isUndefined,b=h.id,j=i.prefs||{},g=null,c=["broadcast","listen","unlisten","closeView","getViewNode","getViewDirection","isViewOpen","navigate","openView","refreshView","setView"],e={getContextData:function(k){var m=i.data,l;if(m){l=(k?m[k]:m);}return(f(l)?g:l);},getId:function(){return b;},getProperty:function(k){var l=h[k];return f(l)?g:l;},getString:function(k){return d.getString(h.type,k);},getPref:function(k){var l=j[k];return f(l)?g:l;},setPref:function(k,l){var m=d.getService("transport");j[k]=l;if(m){m.makeRequest({type:"setpref",prefName:k,prefValue:l,moduleId:b},g,b);return true;}else{return false;}},getService:function(k){return d.getService(k,b);},error:function(k,l){d.error("module",k,a.merge((l?l:{}),{moduleId:b}));},abortRequest:function(k){var l=d.getService("transport");return !!(l&&l.abortRequest(k,b));},isRequestPending:function(k){var l=d.getService("transport");return !!(l&&l.isRequestPending(k,b));},makeRequest:function(k,m){var l=d.getService("transport");return(l?l.makeRequest(k,m,b):-1);}};a.Array.each(c,function(k){e[k]=function(){var l=a.Array(arguments,0,true);l.unshift(b);return d[k].apply(d,l);};});return e;};},"1.0");/* Copyright (c) 2013, Yahoo! Inc.  All rights reserved. */
YUI.add("yui_service",function(d){var b=d.ModulePlatform,a="MPServices",c="YUIProvider";if(d.Plugin&&d.Plugin.NodeFX){d.Node.plug(d.Plugin.NodeFX);}d.namespace(a);d[a][c]={name:"yui",getService:function(e,f){return d;}};if(b){b.registerService(d[a][c]);}},"1.0");/* Copyright (c) 2013, Yahoo! Inc.  All rights reserved. */
